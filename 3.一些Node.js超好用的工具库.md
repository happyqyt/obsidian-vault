# æ–‡ä»¶

## fsï¼ˆå†…ç½®æ¨¡å—ï¼‰

æ–‡æ¡£ï¼šhttps://nodejs.cn/api/fs.html

* Node.jså†…ç½®çš„`fs`æ¨¡å—å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œè´Ÿè´£è¯»å†™æ–‡ä»¶ï¼Œfsæ¨¡å—åŒæ—¶æä¾›äº†`å¼‚æ­¥(å³å›è°ƒ)`å’Œ`åŒæ­¥`çš„æ–¹æ³•ã€‚æä¾›åŒæ­¥æ–¹æ³•æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œä»£ç ç®€å•ï¼Œç¼ºç‚¹æ˜¯ç¨‹åºå°†ç­‰å¾…IOæ“ä½œï¼Œåœ¨ç­‰å¾…æ—¶é—´å†…ï¼Œæ— æ³•å“åº”å…¶å®ƒä»»ä½•äº‹ä»¶ã€‚è€Œå¼‚æ­¥è¯»å–ä¸ç”¨ç­‰å¾…IOæ“ä½œï¼Œä½†ä»£ç è¾ƒéº»çƒ¦ã€‚

* ç”±äºNodeç¯å¢ƒæ‰§è¡Œçš„JavaScriptä»£ç æ˜¯æœåŠ¡å™¨ç«¯ä»£ç ï¼Œæ‰€ä»¥ï¼Œç»å¤§éƒ¨åˆ†éœ€è¦åœ¨æœåŠ¡å™¨è¿è¡ŒæœŸåå¤æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨å¼‚æ­¥ä»£ç ï¼Œå¦åˆ™ï¼ŒåŒæ­¥ä»£ç åœ¨æ‰§è¡Œæ—¶æœŸï¼ŒæœåŠ¡å™¨å°†åœæ­¢å“åº”ï¼Œå› ä¸ºJavaScriptåªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ã€‚

* æœåŠ¡å™¨å¯åŠ¨æ—¶å¦‚æœéœ€è¦è¯»å–é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…ç»“æŸæ—¶éœ€è¦å†™å…¥åˆ°çŠ¶æ€æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥ä»£ç ï¼Œå› ä¸ºè¿™äº›ä»£ç åªåœ¨å¯åŠ¨å’Œç»“æŸæ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¸å½±å“æœåŠ¡å™¨æ­£å¸¸è¿è¡Œæ—¶çš„å¼‚æ­¥æ‰§è¡Œã€‚

* node.jsä»ç‰ˆæœ¬14.21.3å¼€å§‹ï¼Œfsæ¨¡å—å¼€å§‹æ”¯æŒpromiseçš„ç”¨æ³•ã€‚node.jså„ä¸ªç‰ˆæœ¬åŠå…¶æ–‡æ¡£ï¼šhttps://nodejs.org/zh-cn/download/releases
* å½“éœ€è¦æœ€å¤§æ€§èƒ½ï¼ˆåœ¨æ‰§è¡Œæ—¶é—´å’Œå†…å­˜åˆ†é…æ–¹é¢ï¼‰æ—¶ï¼Œ**node:fs æ¨¡å— API çš„åŸºäºå›è°ƒçš„ç‰ˆæœ¬æ¯”ä½¿ç”¨ promise API æ›´å¯å–ã€‚**
* Promise API ä½¿ç”¨åº•å±‚çš„ Node.js çº¿ç¨‹æ± åœ¨äº‹ä»¶å¾ªç¯çº¿ç¨‹ä¹‹å¤–æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚ è¿™äº›æ“ä½œä¸æ˜¯åŒæ­¥çš„ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å¯¹åŒä¸€æ–‡ä»¶æ‰§è¡Œå¤šä¸ªå¹¶å‘ä¿®æ”¹æ—¶å¿…é¡»å°å¿ƒï¼Œå¦åˆ™å¯èƒ½ä¼šæŸåæ•°æ®ã€‚



### ä½¿ç”¨

ä»¥åˆ é™¤æ–‡ä»¶ä¸ºä¾‹ï¼š

1. å¼‚æ­¥æ–¹æ³•ï¼ŒPromiseç¤ºä¾‹

```javascript
import { unlink } from 'node:fs/promises';

(async function(path) {
  try {
    await unlink(path);
    console.log(`successfully deleted ${path}`);
  } catch (error) {
    console.error('there was an error:', error.message);
  }
})('/tmp/hello');
```

2. å¼‚æ­¥æ–¹æ³•ï¼Œå›è°ƒç¤ºä¾‹

   å›è°ƒçš„å½¢å¼å°†å®Œæˆå›è°ƒå‡½æ•°ä½œä¸ºå…¶æœ€åä¸€ä¸ªå‚æ•°å¹¶ä¸”å¼‚æ­¥åœ°è°ƒç”¨è¯¥æ“ä½œã€‚ ä¼ ç»™å®Œæˆå›è°ƒçš„å‚æ•°å–å†³äºæ–¹æ³•ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆé¢„ç•™ç”¨äºå¼‚å¸¸ã€‚ å¦‚æœæ“ä½œæˆåŠŸåœ°å®Œæˆï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°ä¸º `null` æˆ– `undefined`ã€‚

```javascript
import { unlink } from 'node:fs';

unlink('/tmp/hello', (err) => {
  if (err) throw err;
  console.log('successfully deleted /tmp/hello');
});
```

3. åŒæ­¥ç¤ºä¾‹

```javascript
import unlinkSync from 'node:fs';

try {
  unlinkSync('/tmp/hello');
  console.log('successfully deleted /tmp/hello');
} catch (err) {
  // handle the error
}
```



## fs-extra

åœ¨ä½ç‰ˆæœ¬node.jsç¯å¢ƒä¸­ï¼Œ`fs`æ¨¡å—ä¸æ”¯æŒpromiseç”¨æ³•ï¼Œå¯ä»¥ä½¿ç”¨`fs-extra`æ‰©å±•ã€‚`fs-extra`æ˜¯`fs`çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†éå¸¸å¤šçš„ä¾¿åˆ©APIï¼Œå¹¶ä¸”ç»§æ‰¿äº†fsçš„æ‰€æœ‰æ–¹æ³•å’Œä¸ºfsæ–¹æ³•æ·»åŠ äº†promiseçš„æ”¯æŒã€‚

æ–‡æ¡£ï¼šhttps://github.com/jprichardson/node-fs-extra/tree/master/docs

### ä½¿ç”¨

å¤§å¤šæ•°æ–¹æ³•é»˜è®¤ä¸ºå¼‚æ­¥ï¼Œå¦‚æœæœªä¼ é€’å›è°ƒï¼Œåˆ™æ‰€æœ‰å¼‚æ­¥æ–¹æ³•å°†è¿”å›ä¸€ä¸ªpromise. ä»¥å¤åˆ¶å‡½æ•°ä¸ºä¾‹ï¼š

 `copy(src: string, dest: string, [options: object, callback: func])`

1. å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å›promise

```javascript
import fs from 'fs-extra';

fs.copy('/tmp/myfile', '/tmp/mynewfile')
  .then(() => console.log('success!'))
  .catch(err => console.error(err))
```

2. Async/Await

```javascript
import fs from 'fs-extra';

async function copyFiles () {
  try {
    await fs.copy('/tmp/myfile', '/tmp/mynewfile')
    console.log('success!')
  } catch (err) {
    console.error(err)
  }
}
```

3. å¼‚æ­¥æ–¹æ³•ï¼Œå›è°ƒå‡½æ•°

```javascript
import fs from 'fs-extra';

fs.copy('/tmp/myfile', '/tmp/mynewfile', err => {
  if (err) return console.error(err)
  console.log('success!')
})
```

4. ä½¿ç”¨è¿‡æ»¤å‡½æ•°

```javascript
import fs from 'fs-extra';

const filterFunc = (src, dest) => {
  // your logic here
  // it will be copied if return true
}

fs.copy('/tmp/mydir', '/tmp/mynewdir', { filter: filterFunc }, err => {
  if (err) return console.error(err)

  console.log('success!')
})
```

5. åŒæ­¥æ–¹æ³•ï¼Œæ³¨æ„å¿…é¡»ä½¿ç”¨try catchåŒ…è£¹ç€æ‰èƒ½æ•è·é”™è¯¯

```javascript
import fs from 'fs-extra';

try {
  fs.copySync('/tmp/myfile', '/tmp/mynewfile')
  console.log('success!')
} catch (err) {
  console.error(err)
}
```



## æ‰©å±•ä¸€ä¸‹ï¼šnode.jsç‰ˆæœ¬

ç‰ˆæœ¬ç»´æŠ¤è®¡åˆ’ï¼šhttps://github.com/nodejs/release#release-schedule

* LTSï¼ˆLong Term Supportï¼‰ç‰ˆæœ¬æ˜¯é•¿æœŸæ”¯æŒç‰ˆæœ¬çš„ç¼©å†™ï¼Œé€šå¸¸å‘å¤§å¤šæ•°ç”¨æˆ·æ¨è LTS ç‰ˆæœ¬ã€‚LTSå’ŒCurrentå…¶å®å¹¶ä¸æ˜¯ç‰ˆæœ¬ï¼Œè€Œæ˜¯åŒä¸€ä¸ªä¸»ç‰ˆæœ¬å·çš„ä¸åŒé˜¶æ®µã€‚
* LTSåˆåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šActive LTSå’ŒMaintenance LTSã€‚ ä»ä»¥å¾€çš„å‘å¸ƒå†å²çœ‹ï¼ŒLTSè‡³å°‘ä¼šè¢«è·Ÿè¿›2å¹´æ—¶é—´ï¼ŒæŒ‰ç…§æœ€æ–°çš„å®˜æ–¹ç½‘ç«™çš„è¯´æ³•ï¼ŒActive LTSæŒç»­12ä¸ªæœˆï¼ŒMaintenance LTSå°†ä¼šè¢«æŒç»­ç»´æŠ¤18ä¸ªæœˆçš„æ—¶é—´ã€‚Node.js 12ä¹‹å‰ï¼ŒActiveé˜¶æ®µæŒç»­18ä¸ªæœˆï¼ŒMaintenanceé˜¶æ®µæŒç»­12ä¸ªæœˆã€‚
* ä¸€ä¸ªæ–°ä¸»ç‰ˆæœ¬å·releaseåï¼Œå…ˆè¿›å…¥Currenté˜¶æ®µï¼Œè¯¥é˜¶æ®µæŒç»­6ä¸ªæœˆï¼Œç›®çš„æ˜¯ç»™å„ä¸ªåº“(library)çš„ä½œè€…æ—¶é—´æ¥æ”¯æŒæ–°ç‰ˆã€‚å¶æ•°ç‰ˆæœ¬åœ¨Currenté˜¶æ®µåè¿›å…¥LTSé˜¶æ®µï¼Œè€Œå¥‡æ•°ç‰ˆæœ¬åˆ™ç»ˆç»“ä¸å†ç»´æŠ¤ã€‚

> å¦‚ä½•çŸ¥é“ä½ æ˜¯å¦ä½¿ç”¨çš„æ˜¯LTSç‰ˆæœ¬ï¼Ÿ
>
> `node -pe process.release.lts`



# ç‰¹æ®Šæ ¼å¼æ–‡ä»¶

## Excel

### node-xlsx

github starsï¼š **2.8k**

è½»é‡çº§ï¼Œä¾èµ–å°‘ã€‚è§£æå•å…ƒæ ¼å†…å®¹ï¼Œä¸€èˆ¬å¤Ÿç”¨ã€‚ä¸è¿‡ï¼Œä»…æ”¯æŒxlsxæ ¼å¼æ–‡ä»¶ï¼Œä¸èƒ½è¯»å–æ•°æ®æ ·å¼ï¼Œä¸èƒ½è¯»å–å›¾ç‰‡ã€‚

https://github.com/mgcrea/node-xlsx

å®‰è£…ï¼š`npm install node-xlsx -S`

1. è¯»

```javascript
// å¼•å…¥ node-xlsx æ¨¡å—
import xlsx from 'node-xlsx'

// excelæ–‡ä»¶ç±»å¾„
const excelFilePath = './test.xlsx'

//è§£æexcel, è·å–åˆ°æ‰€æœ‰sheets
const sheets = xlsx.parse(excelFilePath);

// æŸ¥çœ‹é¡µé¢æ•°
console.log(sheets.length);

// æ‰“å°é¡µé¢ä¿¡æ¯..
const sheet = sheets[0];
console.log(sheet);

// æ‰“å°é¡µé¢æ•°æ®
console.log(sheet.data);

// è¾“å‡ºæ¯è¡Œå†…å®¹
sheet.data.forEach(row => {
    console.log(row);
    // æ•°ç»„æ ¼å¼, æ ¹æ®ä¸åŒçš„ç´¢å¼•å–æ•°æ®
})

```

2. å†™

```javascript
import xlsx from 'node-xlsx'
import fs from 'node:fs';

var data = [{
        name: 'sheet1',
        data: [
            [
                'ID',
                'Name',
                'Score'
            ],
            [
                '1',
                'Michael',
                '99'
            ],
            [
                '2',
                'Jordan',
                '98'
            ]
        ]
    },
    {
        name: 'sheet2',
        data: [
            [
                'AA',
                'BB'
            ],
            [
                '23',
                '24'
            ]
        ]
    }
]
var buffer = xlsx.build(data);

// å†™å…¥æ–‡ä»¶
fs.writeFile('a.xlsx', buffer, function(err) {
    if (err) {
        console.log("Write failed: " + err);
        return;
    }

    console.log("Write completed.");
});
```

> æ‰©å±•ä¸€ä¸‹ï¼šBufferå¯¹è±¡å’ŒStringçš„è½¬æ¢ï¼š
>
> ```javascript
> // Buffer -> String
> var text = data.toString('utf-8');
> 
> // String -> Buffer
> var buf = Buffer.from(text, 'utf-8');
> ```

### exceljs

github starsï¼š**12K**

ä¾èµ–å¾ˆå¤šã€‚åŠŸèƒ½ååˆ†ä¸°å¯Œï¼Œé…æœ‰ä¸­æ–‡æ–‡æ¡£ã€‚æä¾›æœ‰å…·ä½“æ¥å£å¤„ç†å•å…ƒæ ¼ã€è¡Œã€åˆ—ç­‰ã€‚å¯ä»¥è§£æå‡ºæ•°æ®æ ·å¼ã€‚å¯å¤„ç†å›¾ç‰‡ã€‚https://github.com/exceljs/exceljs

æ–‡æ¡£ï¼šhttps://github.com/exceljs/exceljs/blob/master/README_zh.md



### ejsExcel

github starsï¼š**700**

ä¸€æ¬¾å›½äººå¼€å‘çš„ã€åœ¨Node.jsåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æˆ‘ä»¬é¢„å…ˆè®¾ç½®å¥½çš„Excelæ¨¡æ¿å¯¼å‡ºExcelè¡¨æ ¼çš„æ¨¡æ¿å¼•æ“ã€‚
https://github.com/sail-sail/ejsExcel
https://ejsexcel.com/



### é¡ºå¸¦æä¸€ä¸‹ï¼Œä¸æ¨è

* sheetjs

  ä¾èµ–è¶…å¤šã€‚åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç›®å‰ç¬”è€…åœ¨GitHubä¸Šè§åˆ°å¤„ç†Excelæ–‡ä»¶ï¼Œæ˜Ÿæ•°æœ€å¤šçš„nodejsåº“ï¼Œæ”¯æŒè§£æå¤šç§æ ¼å¼è¡¨æ ¼XLSX / XLSM / XLSB / XLS / CSVã€‚å¯æƒœçš„æ˜¯ï¼Œå¾ˆå¤šå¤„ç†æ•°æ®æ ·å¼çš„åŠŸèƒ½ï¼Œå¹¶ä¸å¼€æºï¼Œä»…é™ä»˜è´¹ä¸“ä¸šç‰ˆç”¨æˆ·ä½¿ç”¨ã€‚
  https://git.sheetjs.com/sheetjs/sheetjs
  https://sheetjs.com/

* js-xlsx

  è„±èƒäºä¸Šé¢çš„sheetjsï¼Œèƒ½å¤Ÿè§£æä¸€äº›æ ·å¼ã€‚å·²å¤šå¹´æœªæ›´æ–°ï¼Œä½¿ç”¨çš„äººè¾ƒå°‘ã€‚https://github.com/protobi/js-xlsx

* excel-parser

  åŸºäºNode.jsè§£æexcelæ–‡ä»¶æ•°æ®ï¼Œæ”¯æŒxlsåŠxlsxæ ¼å¼æ–‡ä»¶ï¼Œéœ€è¦ä¾èµ–pythonï¼Œå¤ªé‡ä¸å¤ªå®ç”¨ã€‚https://github.com/leftshifters/excel-parser



## PDF

### jsPDF

github starsï¼š**27.4K**

ä¸€ä¸ªä½¿ç”¨ JavaScript è¯­è¨€ç”Ÿæˆ PDFçš„å¯ç”¨äºnodeå’Œæµè§ˆå™¨çš„å¼€æºåº“ï¼Œæ–‡æ¡£å®Œå–„ï¼Œç¤ºä¾‹ä¸°å¯Œã€‚æ”¯æŒè®¾ç½®å¯†ç ä¿æŠ¤ï¼Œæ”¯æŒåµŒå…¥å­—ä½“ï¼Œä½†æ˜¯éœ€è¦å°†å­—ä½“è½¬æ¢ä¸ºTTFæ–‡ä»¶ã€‚https://github.com/parallax/jsPDF

##### ä½¿ç”¨

```javascript
import { jsPDF } from "jspdf";

// Default export is a4 paper, portrait, using millimeters for units
const doc = new jsPDF();

doc.text("Hello world!", 10, 10);
doc.save("a4.pdf");
```



### PDFKit

github starsï¼š**9K**

PDFKitæ˜¯åœ¨åºå¤§çš„JavaScriptç”Ÿæ€ç³»ç»Ÿä¸­å‘å¸ƒçš„é¦–æ‰¹ PDF åº“ä¹‹ä¸€ã€‚è‡ª2012å¹´æ¨å‡ºä»¥æ¥ï¼Œå°±å¹¿å—æ¬¢è¿ï¼Œå¹¶ä¸”åˆ°2021å¹´ä»åœ¨æ›´æ–°ã€‚ä½œä¸ºä¸€ä¸ªç”¨äº Node å’Œæµè§ˆå™¨çš„ PDF æ–‡æ¡£å·¥å…·åº“ï¼Œå¯ä»¥åˆ›å»ºå¤æ‚çš„å¤šé¡µå¯æ‰“å°æ–‡æ¡£ï¼Œå…·æœ‰ä¸€å®šçš„ä¸Šæ‰‹éš¾åº¦ã€‚https://pdfkit.org/

##### ç‰¹æ€§

* çŸ¢é‡å›¾å½¢ï¼ˆç±»ä¼¼ç”»å¸ƒæ“ä½œã€è·¯å¾„æ“ä½œã€çº¿æ€§å’Œå¾„å‘æ¸å˜ç­‰ï¼‰
* æ–‡æœ¬ï¼ˆæ¢è¡Œã€å¯¹é½ã€åˆ—è¡¨ç­‰ï¼‰
* å­—ä½“åµŒå…¥
* å›¾åƒåµŒå…¥
* æ³¨é‡Šï¼ˆé“¾æ¥ã€ç¬”è®°ã€ä¸‹åˆ’çº¿ç­‰ï¼‰
* æ¦‚è¦
* å®‰å…¨æ€§ï¼ˆåŠ å¯†ã€è®¿é—®æƒé™ç­‰ï¼‰

##### ä½¿ç”¨

```javascript
import PDFDocument from 'pdfkit'
import fs from 'fs'

const doc = new PDFDocument();

// Pipe its output somewhere, like to a file or HTTP response
doc.pipe(fs.createWriteStream('output.pdf'));

// Embed a font, set the font size, and render some text
doc
  .font('fonts/PingFangTC.ttf')
  .fontSize(25)
  .text('Some text with an embedded font!', 100, 100);

// Add an image, constrain it to a given size, and center it vertically and horizontally
doc.image('path/icon-google-play@2x.png', {
  fit: [250, 300],
  align: 'center',
  valign: 'center'
});

// Add another page
doc
  .addPage()
  .fontSize(25)
  .text('Here is some vector graphics...', 100, 100);

// Draw a triangle
doc
  .save()
  .moveTo(100, 150)
  .lineTo(100, 250)
  .lineTo(200, 250)
  .fill('#FF3300');

// Apply some transforms and render an SVG path with the 'even-odd' fill rule
doc
  .scale(0.6)
  .translate(470, -380)
  .path('M 250,75 L 323,301 131,161 369,161 177,301 z')
  .fill('red', 'even-odd')
  .restore();

// Add some text with annotations
doc
  .addPage()
  .fillColor('blue')
  .text('Here is a link!', 100, 100)
  .underline(100, 100, 160, 27, { color: '#0000FF' })
  .link(100, 100, 160, 27, 'http://google.com/');

// Finalize PDF file
doc.end();
```



### PDF-LIB

github starsï¼š**5.6K**

https://pdf-lib.js.org/

ä¸€ä¸ªnodeå’Œæµè§ˆå™¨ç«¯éƒ½å¯ä½¿ç”¨çš„PDFåº“ï¼Œæ”¯æŒï¼š

* åˆ›å»ºã€ä¿®æ”¹ã€å±•ç¤ºPDF
* PDFåˆå¹¶ã€æ‹†åˆ†ã€åµŒå…¥ã€ä¿®æ”¹
* ç»˜åˆ¶æ–‡æœ¬ã€å›¾åƒå’ŒçŸ¢é‡å›¾å½¢ã€è‡ªå®šä¹‰å­—ä½“ã€æ–‡æ¡£å…ƒæ•°æ®ï¼ˆä½œè€…ã€åˆ›å»ºæ—¥æœŸã€å…³é”®å­—ã€ä¸»é¢˜ã€æ ‡é¢˜ç­‰ï¼‰è®¾ç½®

##### ä½¿ç”¨

```javascript
import { PDFDocument } from 'pdf-lib'
import fs from 'node:fs'

// PDF Creation
const pdfDoc = await PDFDocument.create()
const page = pdfDoc.addPage()
page.drawText('You can create PDFs!')
const pdfBytes = await pdfDoc.save()
fs.writeFileSync('pdflib.pdf', pdfBytes)

// PDF Modification
// const pdfDoc = await PDFDocument.load(...)
// const pages = pdfDoc.getPages()
// pages[0].drawText('You can modify PDFs too!')
// const pdfBytes = await pdfDoc.save()
```



### é¡ºå¸¦æä¸€ä¸‹

##### PDF.js

ä½¿ç”¨ HTML5 æ„å»ºçš„ä¾¿æºå¼æ–‡æ¡£æ ¼å¼ (PDF) æŸ¥çœ‹å™¨ã€‚å®ƒç”±ç¤¾åŒºé©±åŠ¨å¹¶å— Mozilla æ”¯æŒï¼Œç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ã€åŸºäº Web æ ‡å‡†çš„å¹³å°æ¥è§£æå’Œå‘ˆç° PDFã€‚https://github.com/mozilla/pdf.js



##### pdfmake

ä¸€ä¸ªåŸºäºPDFKitæ„å»ºçš„å¯ç”¨äºnodeå’Œæµè§ˆå™¨çš„ç”ŸæˆPDFçš„å·¥å…·åº“ã€‚http://pdfmake.org/



##### pdf-creator-node

æ ¹æ®HTMLæ¨¡ç‰ˆç”ŸæˆPDFæ–‡ä»¶ã€‚https://www.npmjs.com/package/pdf-creator-node

è¯¥å·¥å…·æ‰€ä¾èµ–çš„`html-pdf`åº“å·²åœæ­¢ç»´æŠ¤ã€‚

* ä½¿ç”¨

```javascript
import pdf from "pdf-creator-node"; 
import fs from 'fs'

// è¯»å– HTML æ¨¡æ¿
var html = fs.readFileSync( "./template.html" ,  "utf8" )

var options = {
        format: "A3",
        orientation: "portrait",
        border: "10mm",
        header: {
            height: "45mm",
            contents: '<div style="text-align: center;">Author: Shyam Hajare</div>'
        },
        footer: {
            height: "28mm",
            contents: {
                first: 'Cover page',
                2: 'Second page', // Any page number is working. 1-based index
                default: '<span style="color: #444;">{{page}}</span>/<span>{{pages}}</span>', // fallback value
                last: 'Last Page'
            }
        }
    };

var users = [
  {
    name: "Shyam",
    age: "26",
  },
  {
    name: "Navjot",
    age: "26",
  },
  {
    name: "Vitthal",
    age: "26",
  },
];
var document = {
  html: html,
  data: {
    users: users,
  },
  path: "./output.pdf",
  type: "",
};

pdf
  .create(document, options)
  .then((res) => {
    console.log(res);
  })
  .catch((error) => {
    console.error(error);
  });
```

template.html

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Hello world!</title>
  </head>
  <body>
    <h1>User List</h1>
    <ul>
      {{#each users}}
      <li>Name: {{this.name}}</li>
      <li>Age: {{this.age}}</li>
      <br />
      {{/each}}
    </ul>
  </body>
</html>
```



## å›¾ç‰‡

### sharp

github starsï¼š**26.4k**

è¿™ç§é«˜é€Ÿ Node.js æ¨¡å—çš„å…¸å‹ç”¨ä¾‹æ˜¯å°†å¸¸è§æ ¼å¼çš„å¤§å›¾åƒè½¬æ¢ä¸ºè¾ƒå°çš„ã€ç½‘ç»œå‹å¥½çš„ä¸åŒå°ºå¯¸çš„ JPEGã€PNGã€WebPã€GIF å’Œ AVIF å›¾åƒã€‚

ç”±äºä½¿ç”¨äº†[libvips](https://github.com/libvips/libvips)ï¼Œè°ƒæ•´å›¾åƒå¤§å°é€šå¸¸æ¯”ä½¿ç”¨æœ€å¿«çš„ ImageMagick å’Œ GraphicsMagick è®¾ç½®å¿« 4 å€åˆ° 5 å€ã€‚

è‰²å½©ç©ºé—´ã€åµŒå…¥å¼ ICC é…ç½®æ–‡ä»¶å’Œ Alpha é€æ˜åº¦é€šé“å‡å·²æ­£ç¡®å¤„ç†ã€‚Lanczos é‡é‡‡æ ·ç¡®ä¿ä¸ä¼šä¸ºäº†é€Ÿåº¦è€Œç‰ºç‰²è´¨é‡ã€‚

é™¤äº†å›¾åƒå¤§å°è°ƒæ•´ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ—‹è½¬ã€æå–ã€åˆæˆå’Œä¼½ç›æ ¡æ­£ç­‰æ“ä½œã€‚

å¤§å¤šæ•°è¿è¡Œ Node.js >= 14.15.0 çš„ç°ä»£ macOSã€Windows å’Œ Linux ç³»ç»Ÿä¸éœ€è¦ä»»ä½•é¢å¤–çš„å®‰è£…æˆ–è¿è¡Œæ—¶ä¾èµ–é¡¹ã€‚

æ”¯æŒè¯»å– JPEGã€PNGã€WebPã€GIFã€AVIFã€TIFF å’Œ SVG å›¾åƒã€‚

è¾“å‡ºå›¾åƒå¯ä»¥æ˜¯ JPEGã€PNGã€WebPã€GIFã€AVIF å’Œ TIFF æ ¼å¼ä»¥åŠæœªå‹ç¼©çš„åŸå§‹åƒç´ æ•°æ®ã€‚

- [sharp - npm](https://www.npmjs.com/package/sharp)
- [sharp - å®˜ç½‘](https://sharp.pixelplumbing.com/)
- [sharp - GitHub](https://github.com/lovell/sharp)

##### ä½¿ç”¨

###### åˆ›å»ºå›¾åƒ

> sharp åˆ›å»ºå›¾åƒå¸¸ç”¨çš„æœ‰ä¸‰ç§æ–¹æ³•ï¼Œ**ç›´æ¥ç”Ÿæˆã€ä»æ–‡ä»¶è¯»å–ã€Buffer**

* **ç›´æ¥ç”Ÿæˆ**ï¼šè¿™ä¸ªå°±æ˜¯æ–°å»ºäº†ï¼Œç»™ sharp ä¼ å…¥ä¸€ä¸ªåŒ…å« create å¯¹è±¡çš„å¯¹è±¡ï¼Œcreate é‡Œçš„å†…å®¹å°±æ˜¯æ–°å»ºå›¾åƒçš„é…ç½®ã€‚

```javascript
const image = sharp({
    create: {
        // å®½åº¦
        width: 300,
        // é«˜åº¦
        height: 200,
        // é€šé“æ•°
        channels: 4,
        // æŒ‡å®šèƒŒæ™¯è‰²
        background: 'black' // æˆ–è€… '#000000' æˆ–è€…æ›´è¯¦ç»†çš„ rgba é…ç½®å¯¹è±¡
    }
});
```

* **ä»æ–‡ä»¶è¯»å–**ï¼šè¿™ä¸ªæ›´ç®€å•äº†ï¼Œæä¾›ä¸€ä¸ªè·¯å¾„ï¼Œsharp ä¼šå»è¿™ä¸ªè·¯å¾„æ‰¾å›¾ç‰‡ï¼Œæ‰¾åˆ°äº†å°±è¯»è¿›æ¥ï¼š

```js
const image = sharp('./origin.png');
```

* **ä» Buffer è¯»å–**ï¼šä¼ å…¥ä¸€ä¸ª bufferï¼Œsharp ä¼šç”¨è¿™ä¸ª buffer è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æœ€æœ€å¸¸ç”¨çš„åˆ›å»ºå›¾åƒçš„æ–¹æ³•ï¼ŒåŸå› ä¸‹æ–‡ä¼šæåˆ°ã€‚

```js
// sharp å¯ä»¥è§£æ svgï¼Œå¾ˆå®ç”¨
const buffer = Buffer.from(
    '<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150"></svg>'
)
const image = sharp(buffer)
```

è¿™ç§æ–¹å¼ä¹Ÿé€‚åˆæ‹¿æ¥è¯»ç½‘ç»œè¯·æ±‚æ¥çš„å›¾ç‰‡ï¼š

```js
// ç”¨ axios è¯·æ±‚ç½‘ç»œå›¾ç‰‡
axios.get('http://xxxxx/xx/origin.png', {
    responseType: 'arraybuffer'
}).then(resp => {
    const iamge = sharp(resp.data)
})
```

###### ä¿å­˜å›¾åƒ

* ä¿å­˜å›¾ç‰‡æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ç›´æ¥ä¿å­˜æˆå›¾ç‰‡ï¼š

```js
const buffer = Buffer.from(
    '<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150"></svg>'
)

sharp(buffer)
    .png()
    .toFile('./result.png')
    .then(() => console.log('ä¿å­˜å®Œæˆ'))
```

* ç¬¬äºŒç§æ˜¯è½¬æ¢æˆ bufferï¼Œç„¶åæ€ä¹ˆå¤„ç†å°±éšä½ äº†ï¼š

```js
sharp('./origin.png')
    .png()
    .toBuffer()
    .then(buffer => {
        console.log('buffer', buffer)
    })
```

> è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š
>
> - `toBuffer` å’Œ `toFile` éƒ½æ˜¯å¼‚æ­¥æ–¹æ³•ã€‚æ”¯æŒcallbackã€promiseä»¥åŠasync/awaitç”¨æ³•ï¼ˆè§ä¸‹ç¤ºä¾‹ï¼‰
> - å¦‚æœå®ä¾‹åŒ–çš„å›¾ç‰‡æ˜¯æ— æ ¼å¼çš„ï¼Œè¦å…ˆè°ƒæ–¹æ³•è®¾ç½®å…¶æ–‡ä»¶ç±»å‹ã€‚

```javascript
import sharp from 'sharp'

// callbackç”¨æ³•
sharp(inputBuffer)
  .resize(320, 240)
  .toFile('output.webp', (err, info) => { ... });

// promiseç”¨æ³•
sharp('input.jpg')
  .rotate()
  .resize(200)
  .jpeg({ mozjpeg: true })
  .toBuffer()
  .then( data => { ... })
  .catch( err => { ... });

// Async/awaitç”¨æ³•
const semiTransparentRedPng = await sharp({
  create: {
    width: 48,
    height: 48,
    channels: 4,
    background: { r: 255, g: 0, b: 0, alpha: 0.5 }
  }
}).png()
  .toBuffer();
```



### é¡ºå¸¦æä¸€ä¸‹

##### node-images

Node.jsè½»é‡çº§è·¨å¹³å°å›¾åƒç¼–è§£ç åº“ã€‚https://github.com/zhangyuanwei/node-imagesã€https://www.npmjs.com/package/node-images

æœ‰ä¸¤ä¸‰å¹´æ²¡æ›´æ–°è¿‡äº†ï¼Œæ”¯æŒï¼š

* ä»æŒ‡å®šæ–‡ä»¶åŠ è½½å¹¶è§£ç å›¾åƒã€åˆ›å»ºä¸€ä¸ªæŒ‡å®šå®½é«˜çš„é€æ˜å›¾åƒã€ä»Bufferæ•°æ®ä¸­è§£ç å›¾åƒã€ä»å¦ä¸€ä¸ªå›¾åƒä¸­å¤åˆ¶åŒºåŸŸæ¥åˆ›å»ºå›¾åƒï¼ˆè£å‰ªï¼‰
* é¢œè‰²å¡«å……ã€ç»˜åˆ¶å›¾åƒã€æ—‹è½¬å›¾ç‰‡
* ç¼–ç è½¬æ¢ï¼šdecoder(png/jpeg/gif)ã€ encoder(png/jpeg)
* è·å–å°ºå¯¸ï¼Œè½¬æ¢å°ºå¯¸
* ä¿å­˜å›¾åƒåˆ°æ–‡ä»¶



# é‚®ä»¶

## Nodemailer

ä¸€ä¸ªç®€å•æ˜“ç”¨çš„Node.jsé‚®ä»¶å‘é€ç»„ä»¶ã€‚

https://nodemailer.com/

https://github.com/nodemailer/nodemailer

### Feature

- å…·æœ‰é›¶ä¾èµ–å…³ç³»çš„å•ä¸€æ¨¡å—, ä»£ç å®¹æ˜“å®¡æ ¸ï¼Œæ²¡æœ‰æ­»è§’
- `Unicode`æ”¯æŒä½¿ç”¨ä»»ä½•å­—ç¬¦ï¼ŒåŒ…æ‹¬è¡¨æƒ…ç¬¦å·ğŸ’ª
- é‚®ä»¶å†…å®¹æ—¢æ”¯æŒæ™®é€šæ–‡æœ¬, è¿˜æ”¯æŒè‡ªå®šä¹‰`html`
- æ”¯æŒè‡ªå®šä¹‰é™„ä»¶
- æ”¯æŒå®‰å…¨å¯é çš„`SSL/STARTTLS`é‚®ä»¶å‘é€
- æ”¯æŒè‡ªå®šä¹‰æ’ä»¶å¤„ç†é‚®ä»¶æ¶ˆæ¯

### ä½¿ç”¨

```js
import nodemailer from "nodemailer";

const transporter = nodemailer.createTransport({
  host: "smtp.forwardemail.net",
  port: 465,
  secure: true,
  auth: {
    user: "REPLACE-WITH-YOUR-ALIAS@YOURDOMAIN.COM",
    pass: "REPLACE-WITH-YOUR-GENERATED-PASSWORD",
  },
});

// async..await is not allowed in global scope, must use a wrapper
async function main() {
  // send mail with defined transport object
  const info = await transporter.sendMail({
    from: '"Fred Foo ğŸ‘»" <foo@example.com>', // sender address
    to: "bar@example.com, baz@example.com", // list of receivers
    cc: "ccc@example.com, ddd@example.com", // æŠ„é€
    bcc: "bcc1@example.com, bcc2@example.com", // ç§˜å¯†æŠ„é€
    subject: "Hello âœ”", // Subject line
    text: "Hello world?", // plain text body
    html: "<b>Hello world?</b>", // html bodyï¼Œå¦‚æœå®šä¹‰äº†htmlï¼Œå°†å¿½ç•¥text
    attachments: [] // é™„ä»¶
  });

  console.log("Message sent: %s", info.messageId);
}

main().catch(console.error);
```

# åŠ è§£å¯†

## crypto.js

æœ¬æ¨¡å—æ˜¯å¯¹åŸç”Ÿçš„`crypto`æ¨¡å—äºŒæ¬¡å°è£…çš„ï¼Œåœ¨ä½¿ç”¨ä¸Šæ›´åŠ ç®€å•æ–¹ä¾¿ã€‚

https://github.com/brix/crypto-js

https://www.npmjs.com/package/crypto.js

### ä½¿ç”¨

```js
import crypto, {
  origin,
  rand, 
  uuid, 
  md5,
  md5Sign, 
  hmac,
  sha1, 
  sha1Sign,
  sha256,
  sha256Sign,
  base64encode,
  base64decode,
  cipher,
  decipher
} from 'crypto.js'
// originï¼Œå³ä¸ºåŸç”Ÿçš„cryptoå¯¹è±¡ï¼Œæ–¹ä¾¿åœ¨å°è£…çš„æ–¹æ³•ä¸­æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä»¥è‡ªè¡Œè°ƒç”¨åŸç”Ÿçš„cryptoå®ç°ã€‚


// rand(len[, onlyNumber])ï¼šè¯¥æ–¹æ³•ç”¨äºç”ŸæˆæŒ‡å®šé•¿åº¦çš„éšæœºå­—ç¬¦ä¸²[a-z-A-z0-9]
// 		len <Number> éœ€è¦çš„å­—ç¬¦é•¿åº¦
// 		onlyNumber <Boolean> è¿”å›çº¯æ•°å­—å­—ç¬¦ä¸² [å¯é€‰]
rand(6, true) // 439875
rand(6) // ddjF7d

// uuid()ï¼šè¿”å›ä¸€ä¸ªå¦‚ä¸‹æ ¼å¼çš„ xxxxxxxx-xxxx-xxxx-xxxxxxxx çš„å”¯ä¸€ID
uuid() // 076d029f-4927-ec5f-5b06e35e

// md5(str[, encode])ï¼šè·å–md5
//		str <Number> | <String>
//		encode <String> å¯é€‰ï¼Œè¦è¿”å›çš„å­—ç¬¦ä¸²ç¼–ç ï¼Œé»˜è®¤ä¸ºhexï¼Œå¯é€‰base64
md5(123456) // e10adc3949ba59abbe56e057f20f883e

// md5Sign(file)ï¼šè¯¥æ–¹æ³•ç”¨äºè®¡ç®—æ–‡ä»¶çš„md5ç­¾åï¼Œfileå³ä¸ºæ–‡ä»¶çš„è·¯å¾„ã€‚
// 		file <String>
md5Sign('xx.jpg')

// hmac(mode, data[, key][, outEncode])ï¼šHMACç®—æ³•ï¼Œæ˜¯åœ¨æ•£åˆ—ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œä¸ä¸€ä¸ªå¯†é’¥ç»“åˆåœ¨ä¸€èµ·ï¼Œä»¥é˜»æ­¢å¯¹ç­¾åå®Œæ•´æ€§çš„ç ´åã€‚ 
hmac('md5', '123456', 'sdfvkjfhd')

// base64encode(str[, urlFriendly])ï¼šbase64ç¼–ç ï¼Œä¸»è¦æ˜¯ç¬¬2ä¸ªå‚æ•°ï¼Œæ˜¯æŒ‡ç¼–ç çš„ç»“æœæ˜¯å¦å¯¹URLå‹å¥½ï¼Œé»˜è®¤ä¸ºå¦; å¦‚æœä¸ºtrueï¼Œåˆ™ä¼šæŠŠ+è½¬æˆ-ï¼Œ/è½¬æˆ_ (éµå¾ªRFC4648æ ‡å‡†)ã€‚
// base64decode(str[, urlFriendly])ï¼šbase64è§£ç ã€‚
// 		str <Number> | <String> | <Buffer>
// 		urlFriendly <Boolean> å¯é€‰
base64encode('hello world')
base64decode('aGVsbG8gd29ybGQ=') // .toString('utf-8')  === hello world

// cipher(mode, data[, key, inEncode, outEncode])ï¼šåŠ å¯†ï¼Œv3.xå¼€å§‹, cipher()å†…éƒ¨æ”¹æˆè°ƒç”¨ cipheriv()
// decipher(mode, data[, key, tag, inEncode, outEncode])ï¼šä¸cipherå¯¹åº”çš„è§£å¯†æ–¹æ³•
//		mode <String>ï¼Œç®—æ³•ç±»å‹
//		data <String> | <Buffer>
//		key <String> å¯é€‰, é»˜è®¤ä¸º <Buffer d7 2c 87 d0 f0 77 c7 76 6f 29 85 df ab 30 e8 95>, å³ crypto.scryptSync('', '', 16) çš„ç»“æœ
//		inEncode '' å¯é€‰
//		outEncode '' å¯é€‰ï¼Œé»˜è®¤base64
// 		tag <Buffer> å¯é€‰ï¼Œmodeä¸ºgcmç®—æ³•æ—¶å¿…å¡«
cipher('aes-128-cbc', '123456') // 49jhPgnAW/XkY67IaNq9rw==
decipher('aes-128-cbc', '49jhPgnAW/XkY67IaNq9rw==') // 123456
```



## cryptoï¼ˆå†…ç½®æ¨¡å—ï¼‰

nodeJsçš„å†…ç½®åŠ è§£å¯†æ¨¡å—ï¼ŒåŒ…æ‹¬å¯¹OpenSSL çš„å“ˆå¸Œã€HMACã€åŠ å¯†ã€è§£å¯†ã€ç­¾åã€ä»¥åŠéªŒè¯åŠŸèƒ½çš„ä¸€æ•´å¥—å°è£…ã€‚æ–‡æ¡£ï¼šhttps://nodejs.cn/api/crypto.html

### ä½¿ç”¨

##### Hashï¼ˆæ‘˜è¦ï¼‰ç®—æ³•

> ä»¥MD5ä¸ºä¾‹ï¼ŒMD5ï¼ˆMessage-Digest Algorithmï¼‰æ˜¯è®¡ç®—æœºå®‰å…¨é¢†åŸŸå¹¿æ³›ä½¿ç”¨çš„æ•£åˆ—å‡½æ•°ï¼ˆåˆç§°å“ˆå¸Œç®—æ³•ã€æ‘˜è¦ç®—æ³•ï¼‰ï¼Œä¸»è¦ç”¨æ¥ç¡®ä¿æ¶ˆæ¯çš„å®Œæ•´å’Œä¸€è‡´æ€§ã€‚
>
> å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼šå¯†ç ä¿æŠ¤ã€ä¸‹è½½æ–‡ä»¶æ ¡éªŒç­‰ã€‚

éœ€è¦ä½¿ç”¨åˆ°çš„apiï¼š

* crypto.createHash(algorithm[, options])

  createHash æ–¹æ³•ä¼ å…¥éœ€è¦çš„æ‘˜è¦ç®—æ³•`algorithm`ï¼Œä¾‹å¦‚ md5ã€sha1ã€sha256 å’Œsha512ç­‰ã€‚å¯é€‰çš„ `options` å‚æ•°æ§åˆ¶æµçš„è¡Œä¸ºã€‚

* hash.update(data[, input_encoding])

  * update æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°`input_encoding`æŒ‡å®š`data`çš„ç¼–ç ï¼Œå¯ä»¥æ˜¯`utf8`ã€`ascii`æˆ–è€…å…¶ä»–ã€‚

  * å¦‚æœ`data`æ˜¯å­—ç¬¦ä¸²ï¼Œä¸”æ²¡æœ‰æŒ‡å®š`input_encoding`ï¼Œåˆ™é»˜è®¤ç¼–ç ä¸º `UTF-8`ã€‚

  * `data`ä¹Ÿå¯ä»¥ä¸º `Buffer`ç±»å‹ï¼Œå¦‚æœæ˜¯Bufferç±»å‹ï¼Œåˆ™å¿½ç•¥input_incodingå‚æ•°ã€‚

  * `update()` å¯ä»¥å¤šæ¬¡è¢«è°ƒç”¨ï¼Œå¤šæ¬¡è°ƒç”¨åªæ˜¯ç®€å•çš„æŠŠè¦åŠ å¯†çš„ç»“æœæ‹¼æ¥èµ·æ¥

* hash.digest([encoding])

  è®¡ç®—æ‘˜è¦ã€‚encodingå¯ä»¥æ˜¯`hex`ã€`base64`æˆ–å…¶ä»–ã€‚å¦‚æœå£°æ˜äº†encodingï¼Œé‚£ä¹ˆè¿”å›å­—ç¬¦ä¸²ã€‚å¦åˆ™ï¼Œè¿”å›Bufferå®ä¾‹ã€‚æ³¨æ„ï¼Œè°ƒç”¨hash.digest()åï¼Œhashå¯¹è±¡å°±ä½œåºŸäº†ï¼Œå†æ¬¡è°ƒç”¨å°±ä¼šæŠ¥é”™ã€‚


```js
import crypto from 'crypto'

function getMd5 (data) {
	const md5 = crypto.createHash('md5');
  const result = md5.update(data).digest('hex');
  return result;
}

console.log(getMd5('Hello, world!'))
// è¾“å‡ºï¼š6cd3556deb0da54bca060b4c39479839
```

#####   HMAC

> HMACçš„å…¨ç§°æ˜¯Hash-based Message Authentication Codeï¼Œä¹Ÿå³åœ¨hashçš„åŠ ç›è¿ç®—ã€‚
>
> å…·ä½“åˆ°ä½¿ç”¨çš„è¯ï¼Œè·Ÿhashæ¨¡å—å·®ä¸å¤šï¼Œé€‰å®šhashç®—æ³•ï¼ŒæŒ‡å®šâ€œç›â€å³å¯ã€‚

```js
import crypto from 'crypto'

function getHmac (data) {
  const SECRET = 'vesync';
	const hmac = crypto.createHmac('sha256', SECRET);
  const result = hmac.update(data).digest('hex');
  return result;
}

console.log(getHmac('Hello, world!'))
// è¾“å‡ºï¼š32b1ad8df30bd22fcff991f863b4bec0a72711930475b94d637104848ecbee54
```

##### åŠ å¯†/è§£å¯†

> åŠ è§£å¯†ä¸»è¦ç”¨åˆ°ä¸‹é¢ä¸¤ç»„æ–¹æ³•ï¼š
>
> - åŠ å¯†ï¼šcrypto.createCipheriv(algorithm, key, iv)
> - è§£å¯†ï¼šcrypto.createDecipheriv(algorithm, key, iv)

* `crypto.createCipheriv / crypto.createDecipheriv`

  algorithmï¼šåŠ å¯†ç®—æ³•ï¼Œæ¯”å¦‚`aes192`

  - å…·ä½“æœ‰å“ªäº›å¯é€‰çš„ç®—æ³•ï¼Œä¾èµ–äºæœ¬åœ°`openssl`çš„ç‰ˆæœ¬

  - å¯ä»¥é€šè¿‡`openssl list-cipher-algorithms`å‘½ä»¤æŸ¥çœ‹æ”¯æŒå“ªäº›ç®—æ³•

    

  `key `æ˜¯`algorithm` ä½¿ç”¨çš„åŸå§‹å¯†é’¥ï¼Œ`iv` æ˜¯ `åˆå§‹åŒ–å‘é‡`ï¼Œkeyã€iv å¯ä»¥æ˜¯Bufferï¼Œä¹Ÿå¯ä»¥æ˜¯utf8ç¼–ç çš„å­—ç¬¦ä¸²ã€‚å¦‚æœåŠ å¯†ä¸éœ€è¦åˆå§‹åŒ–å‘é‡ï¼Œåˆ™ `iv` å¯ä»¥æ˜¯ `null`ã€‚

  è¿™é‡Œéœ€è¦å…³æ³¨çš„æ˜¯å®ƒä»¬çš„é•¿åº¦ï¼š

  - keyï¼šæ ¹æ®é€‰æ‹©çš„ç®—æ³•æœ‰å…³ã€‚æ¯”å¦‚ aes128ã€aes192ã€aes256ï¼Œé•¿åº¦åˆ†åˆ«æ˜¯128ã€192ã€256ä½ï¼ˆ16ã€24ã€32å­—èŠ‚ï¼‰
  - ivï¼šåˆå§‹åŒ–å‘é‡ï¼Œéƒ½æ˜¯128ä½ï¼ˆ16å­—èŠ‚ï¼‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå¯†ç ç›çš„ä¸€ç§

```js
import crypto from 'crypto'

const key = crypto.randomBytes(192 / 8)
const iv = crypto.randomBytes(128 / 8)
const ALGORITHM = 'aes192'
const content = 'Hello Node.js'
const encoding = 'hex'

// åŠ å¯†
function myEncrypt(message) {
    const cipher = crypto.createCipheriv(ALGORITHM, key, iv);
    cipher.update(message);
    let crypted = cipher.final(encoding);
    return crypted;
};

// è§£å¯†
function myDecrypt(encrypted) {
    const cipher = crypto.createDecipheriv(ALGORITHM, key, iv);
    cipher.update(encrypted, encoding);
    let decrypted = cipher.final("utf8");
    return decrypted;
};

const enCode = myEncrypt("CondorHero");
console.log(enCode); // ed229cc9ce97b072efa08c56e82dbd68
const deCode = myDecrypt(enCode);
console.log(deCode); // CondorHero
```

##### æ•°å­—ç­¾å / ç­¾åæ ¡éªŒ

> å‡è®¾ï¼š
>
> - æœåŠ¡ç«¯åŸå§‹ä¿¡æ¯ä¸ºMï¼Œæ‘˜è¦ç®—æ³•ä¸ºHashï¼ŒHash(M)å¾—å‡ºçš„æ‘˜è¦æ˜¯H
> - å…¬é’¥ä¸ºPubï¼Œç§é’¥ä¸ºPivï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•ä¸ºEncryptï¼Œéå¯¹ç§°è§£å¯†ç®—æ³•ä¸ºDecrypt
> - Encrypt(H)å¾—åˆ°çš„ç»“æœæ˜¯S
> - å®¢æˆ·ç«¯æ‹¿åˆ°çš„ä¿¡æ¯ä¸ºM1ï¼Œåˆ©ç”¨Hash(M1)å¾—å‡ºçš„ç»“æœæ˜¯H1

æ•°å­—ç­¾åçš„äº§ç”Ÿã€æ ¡éªŒæ­¥éª¤åˆ†åˆ«å¦‚ä¸‹ï¼š

- æ•°å­—ç­¾åçš„äº§ç”Ÿæ­¥éª¤ï¼š
  - åˆ©ç”¨æ‘˜è¦ç®—æ³•Hashç®—å‡ºMçš„æ‘˜è¦ï¼Œå³Hash(M) == H
  - åˆ©ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†Encrypt( H, Piv )ï¼Œå¾—åˆ°æ•°å­—ç­¾åS
- æ•°å­—ç­¾åçš„æ ¡éªŒæ­¥éª¤ï¼š
  - åˆ©ç”¨è§£å¯†ç®—æ³•Då¯¹æ•°å­—ç­¾åè¿›è¡Œè§£å¯†ï¼Œå³Decrypt(S) == H
  - è®¡ç®—M1çš„æ‘˜è¦ Hash(M1) == H1ï¼Œå¯¹æ¯” Hã€H1ï¼Œå¦‚æœä¸¤è€…ç›¸åŒï¼Œåˆ™é€šè¿‡æ ¡éªŒ

```js
import crypto from 'crypto'
import fs from 'fs';
const privateKey = fs.readFileSync('./rsa_1024_priv.pem');  // ç§é’¥
const publicKey = fs.readFileSync('./rsa_1024_pub.pem');  // å…¬é’¥
const algorithm = 'RSA-SHA256';  // åŠ å¯†ç®—æ³• vs æ‘˜è¦ç®—æ³•
const encoding = 'hex'

// æ•°å­—ç­¾å
function sign(text){
    const sign = crypto.createSign(algorithm);
    sign.update(text); // æ­¤æ–¹æ³•å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨
    return sign.sign(privateKey, encoding);
}

// æ ¡éªŒç­¾å
function verify(oriContent, signature){
    const verifier = crypto.createVerify(algorithm);
    verifier.update(oriContent);
    return verifier.verify(publicKey, signature, encoding);
}

// å¯¹å†…å®¹è¿›è¡Œç­¾å
const content = 'hello world';
const signature = sign(content);
console.log(signature);

// æ ¡éªŒç­¾åï¼Œå¦‚æœé€šè¿‡ï¼Œè¿”å›true
const verified = verify(content, signature);
console.log(verified);
```

> ã€é™„ã€‘
>
> linuxæˆ–macOSç³»ç»Ÿç”Ÿæˆç§é’¥ï¼š`openssl genrsa -out rsa_1024_priv.pem 1024`
>
> æŸ¥çœ‹ç§é’¥ï¼š`cat rsa_1024_priv.pem`
>
> linuxæˆ–macOSç³»ç»Ÿç”Ÿæˆå…¬é’¥ï¼š`openssl rsa -pubout -in rsa_1024_priv.pem -out rsa_1024_pub.pem`
>
> æŸ¥çœ‹å…¬é’¥ï¼š`cat rsa_1024_pub.pem`



# åŠ è§£å‹

> ä¼—æ‰€å‘¨çŸ¥ï¼Œé€šè¿‡ç½‘ç»œä¸Šä¼ æˆ–è€…ä¸‹è½½æ•°æ®çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æ˜¯è¦èŠ±æµé‡çš„ï¼Œå³éœ€è¦èŠ±é’±çš„ã€‚å°½ç®¡ç°å­˜çš„å‹ç¼©ç®—æ³•å·²ç»æœ‰å‡ åä¸Šç™¾ç§ï¼Œä½†å…¶ä¸­æœ€æµè¡Œçš„å‹ç¼©ç®—æ³•å¯èƒ½è¿˜æ˜¯ **zip**ã€‚
>
> **gzip** å‹ç¼©ç®—æ³•è™½ç„¶å’Œ **zip** æœ‰ç€ç›¸ä¼¼çš„åå­—ï¼Œä½†å´æ˜¯å¦ä¸€ç§ä¸åŒçš„ç®—æ³•ã€‚gzip ç®—æ³•åº”ç”¨ä¹Ÿç›¸å½“å¹¿æ³›ï¼Œå®ƒè¢« HTTP ä¸‰ç§æ ‡å‡†å‹ç¼©è§„èŒƒä¹‹ä¸€ï¼ˆå±äºç«¯åˆ°ç«¯å‹ç¼©æŠ€æœ¯ï¼Œå‚è§**[HTTP åè®®ä¸­çš„æ•°æ®å‹ç¼©](https://link.zhihu.com/?target=https%3A//developer.mozilla.org/zh-CN/docs/Web/HTTP/Compression)**ï¼‰æ‰€é‡‡ç”¨ã€‚
>
> è™½ç„¶å„ç§å‹ç¼©ç®—æ³•é€‚ç”¨äºä¸åŒåœºæ™¯ï¼Œä½†æ˜¯å®ƒä»¬çš„åº•å±‚éƒ½æ˜¯åŸºäº **[DEFLATE](https://zh.wikipedia.org/wiki/Deflate)**ï¼Œ**DEFLATE** æ˜¯åŒæ—¶ä½¿ç”¨äº† **LZ77** ç®—æ³•ä¸**å“ˆå¤«æ›¼ç¼–ç **ï¼ˆHuffman Codingï¼‰çš„ä¸€ç§æ— æŸæ•°æ®å‹ç¼©ç®—æ³•ã€‚
>
> 
>
> `zip` å’Œ `gzip` æ˜¯ä¸¤ç§æˆ‘ä»¬æœ€å¸¸è§åˆ°çš„å‹ç¼©æ ¼å¼ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºå‹ç¼©ç®—æ³•å’Œå‹ç¼©æ•ˆç‡ã€‚
>
> * ä¸ zip ç›¸æ¯”ï¼Œgzip å¯ä»¥å®ç°æ›´å¥½çš„å‹ç¼©ï¼Œå‹ç¼©ç‡æ¯”zipæ ¼å¼æ›´é«˜ï¼Œä½†å‹ç¼©é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚
>
> * zip å¯ä»¥å½’æ¡£å’Œå‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œè€Œ gzip ä»…å¯ä»¥å‹ç¼©ã€‚è€Œ tar æ˜¯ä¸€ç§å½’æ¡£æ ¼å¼ï¼Œå®ƒé»˜è®¤ä¸ä¼šå‹ç¼©ï¼Œtar å’Œ gzip ç»“åˆå°†å¤šä¸ªæ–‡ä»¶å½’æ¡£ä¸ºä¸€ä¸ª tar æ–‡ä»¶å¹¶ä»¥ gzip æ ¼å¼å‹ç¼©æˆä¸ºä¸€ä¸ª tar.gz æ–‡ä»¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šç¼©å†™ä¸º tgzã€‚
> * zipè¿˜æ”¯æŒå¯†ç ä¿æŠ¤å’ŒåŠ å¯†ï¼Œgzipåˆ™ä¸æ”¯æŒã€‚
>
> * zip åœ¨Windowsä¸Šç›¸å½“æµè¡Œï¼Œè€Œ gzip åœ¨ç±»ä¼¼UNIXçš„æ“ä½œç³»ç»Ÿä¸Šæ›´ä¸ºæµè¡Œã€‚

## zlibï¼ˆå†…ç½®æ¨¡å—ï¼‰

å‹ç¼©æˆ–è€…è§£å‹æ•°æ®æµ(ä¾‹å¦‚ä¸€ä¸ªæ–‡ä»¶)é€šè¿‡`zlib`æµå°†æºæ•°æ®æµä¼ è¾“åˆ°ç›®æ ‡æµä¸­æ¥å®Œæˆã€‚

```js
import zlib from 'zlib';
import fs from 'fs';

const gzip = zlib.createGzip();
const inp = fs.createReadStream('input.txt');
const out = fs.createWriteStream('input.txt.gz');

inp.pipe(gzip).pipe(out);
```

ä¹Ÿå¯ä»¥é€šè¿‡`zlib`æä¾›çš„æ–¹æ³•å¯¹å­—ç¬¦ä¸²æˆ–è€…Bufferå¯¹è±¡è¿›è¡Œå‹ç¼©æˆ–è§£å‹ç¼©ã€‚

```js
import zlib from 'zlib';

const input = '.................................';
zlib.deflate(input, (err, buffer) => {
  if (!err) {
    console.log(buffer.toString('base64'));
  } else {
    // é”™è¯¯å¤„ç†
  }
});

const buffer = Buffer.from('eJzT0yMAAGTvBe8=', 'base64');
zlib.unzip(buffer, (err, buffer) => {
  if (!err) {
    console.log(buffer.toString());
  } else {
    // é”™è¯¯å¤„ç†
  }
});
```



## Compressing

github starsï¼š**26.4k**		Weekly Downloadsï¼š**33,872**

https://github.com/node-modules/compressing

https://www.npmjs.com/package/compressing

API éå¸¸å‹å¥½ï¼Œæ”¯æŒæµå¼æ¥å£ï¼Œè€Œä¸”å¤„äºæ´»è·ƒçš„ç»´æŠ¤çŠ¶æ€ã€‚æ”¯æŒ gzipã€tarã€tgzã€zipã€‚

```js
import compressing from 'compressing';

// é€‰æ‹© gzip æ ¼å¼ï¼Œç„¶åè°ƒç”¨ compressFile æ–¹æ³•
compressing.gzip.compressFile('urllib.js', 'urllib.js.gz')
  .then(() => {
    console.log('success');
  })
  .catch(err => {
    console.error(err);
  });

// è§£å‹ç¼©æ˜¯åå‘è¿‡ç¨‹ï¼Œæ¥å£éƒ½ç»Ÿä¸€ä¸º uncompress
compressing.gzip.uncompress('urllib.js.gz', 'urllib.js2')
  .then(() => {
    console.log('success');
  })
  .catch(err => {
    console.error(err);
  });
```

æ”¯æŒ`async/await`ç¼–ç¨‹ï¼Œæ”¯æŒStream æ¨¡å¼ç¼–ç¨‹ã€‚



# æ•°æ®åº“

## Sequelize

github starsï¼š**28.6k**		Weekly Downloadsï¼š**1,163,933**

https://www.sequelize.cn/

Sequelize æ˜¯ä¸€ä¸ªåŸºäº promise çš„ Node.js [ORM](https://en.wikipedia.org/wiki/Object-relational_mapping), ç›®å‰æ”¯æŒ [Postgres](https://en.wikipedia.org/wiki/PostgreSQL), [MySQL](https://en.wikipedia.org/wiki/MySQL), [MariaDB](https://en.wikipedia.org/wiki/MariaDB), [SQLite](https://en.wikipedia.org/wiki/SQLite) ä»¥åŠ [Microsoft SQL Server](https://en.wikipedia.org/wiki/Microsoft_SQL_Server). å®ƒå…·æœ‰å¼ºå¤§çš„äº‹åŠ¡æ”¯æŒ, å…³è”å…³ç³», é¢„è¯»å’Œå»¶è¿ŸåŠ è½½,è¯»å–å¤åˆ¶ç­‰åŠŸèƒ½ã€‚

### ä½¿ç”¨

```js
const { Sequelize } = require('sequelize');

// æ–¹æ³• 1: ä¼ é€’ä¸€ä¸ªè¿æ¥ URI
const sequelize = new Sequelize('sqlite::memory:') // Sqlite ç¤ºä¾‹
const sequelize = new Sequelize('postgres://user:pass@example.com:5432/dbname') // Postgres ç¤ºä¾‹

// æ–¹æ³• 2: åˆ†åˆ«ä¼ é€’å‚æ•° (sqlite)
const sequelize = new Sequelize({
  dialect: 'sqlite',
  storage: 'path/to/database.sqlite'
});

// æ–¹æ³• 3: åˆ†åˆ«ä¼ é€’å‚æ•° (å…¶å®ƒæ•°æ®åº“)
const sequelize = new Sequelize('database', 'username', 'password', {
  host: 'localhost',
  dialect: /* one of 'mysql' | 'postgres' | 'sqlite' | 'mariadb' | 'mssql' | 'db2' | 'snowflake' | 'oracle' */
});
```

> Sequelize æä¾›çš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„,å› æ­¤è¿”å› Promises. å®ƒä»¬éƒ½æ˜¯ [Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise), å› æ­¤ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨Promise API(ä¾‹å¦‚,ä½¿ç”¨ `then`, `catch`, `finally`).
>
> å½“ç„¶,ä½¿ç”¨ `async` å’Œ `await` ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œ.

> æ¨¡å‹æ˜¯ Sequelize çš„æœ¬è´¨. æ¨¡å‹æ˜¯ä»£è¡¨æ•°æ®åº“ä¸­è¡¨çš„æŠ½è±¡. åœ¨ Sequelize ä¸­,å®ƒæ˜¯ä¸€ä¸ª [Model](https://sequelize.org/api/v6/class/src/model.js~Model.html) çš„æ‰©å±•ç±».
>
> è¯¥æ¨¡å‹å‘Šè¯‰ Sequelize æœ‰å…³å®ƒä»£è¡¨çš„å®ä½“çš„å‡ ä»¶äº‹,ä¾‹å¦‚æ•°æ®åº“ä¸­è¡¨çš„åç§°ä»¥åŠå®ƒå…·æœ‰çš„åˆ—(åŠå…¶æ•°æ®ç±»å‹).
>
> å®šä¹‰ä¸€ä¸ªæ¨¡å‹åï¼Œé€šè¿‡æ¨¡å‹å®ä¾‹è¿›è¡Œæ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚

> é™¤äº†å€ŸåŠ©æ¨¡å‹å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ [sequelize.query](https://sequelize.org/api/v6/class/src/sequelize.js~Sequelize.html#instance-method-query) æ‰§è¡ŒåŸå§‹/å·²ç»å‡†å¤‡å¥½çš„SQLæŸ¥è¯¢ã€‚å¦‚ï¼š
>
> ```js
> const [results, metadata] = await sequelize.query("UPDATE users SET y = 42 WHERE x = 12");
> // ç»“æœå°†æ˜¯ä¸€ä¸ªç©ºæ•°ç»„,å…ƒæ•°æ®å°†åŒ…å«å—å½±å“çš„è¡Œæ•°.
> ```



## MySQL

### å®‰è£…

```
$ npm install mysql
```

### ç¤ºä¾‹

```JS
const mysql = require('mysql')
const connection = mysql.createConnection({
  host: 'localhost',
  user: 'dbuser',
  password: 's3kreee7',
  database: 'my_db'
})

connection.connect()

connection.query('SELECT 1 + 1 AS solution', (err, rows, fields) => {
  if (err) throw err

  console.log('The solution is: ', rows[0].solution)
})

connection.end()
```

## MongoDB

### å®‰è£…

```
$ npm install mongodb
```

### ç¤ºä¾‹

```js
const MongoClient = require('mongodb').MongoClient

MongoClient.connect('mongodb://localhost:27017/animals', (err, client) => {
  if (err) throw err

  const db = client.db('animals')

  db.collection('mammals').find().toArray((err, result) => {
    if (err) throw err

    console.log(result)
  })
})
```

**æ›´å¤šæ•°æ®åº“é›†æˆæ–¹å¼ï¼Œè¯·æŸ¥é˜…ï¼š**

https://nodejs.cn/express/guide/database-integration/

https://www.runoob.com/nodejs/nodejs-mysql.html

https://www.runoob.com/nodejs/nodejs-mongodb.html

https://learn.microsoft.com/zh-cn/azure/azure-sql/database/connect-query-nodejs?view=azuresql&tabs=macos



# ä½œä¸šè°ƒåº¦

> ä½œä¸šè°ƒåº¦æ˜¯æŒ‡åœ¨é¢„å®šæ—¶é—´æˆ–å‘ç”ŸæŸäº›äº‹ä»¶æ—¶è§¦å‘ä½œä¸šã€ä»»åŠ¡æˆ–åŠŸèƒ½çš„è¿‡ç¨‹ã€‚

ä¸‹é¢æ˜¯ä¸€äº›æœ€æµè¡Œçš„è°ƒåº¦å™¨çš„ä¸€äº›æŒ‡æ ‡æ¯”å¯¹ï¼š

|                                                              | Install bundle size | Publish bundle size | Minified gzipped bundle size | GitHub stars | Versions released | Weekly downloads | Documentation | License |
| ------------------------------------------------------------ | ------------------- | ------------------- | ---------------------------- | ------------ | ----------------- | ---------------- | ------------- | ------- |
| [Agenda](https://github.com/agenda/agenda)                   | 25.0MB              | 393KB               | 352.6KB                      | 9.1k         | 88                | 96,271           | Good          | MIT     |
| [Cron](https://github.com/kelektiv/node-cron)                | 3.88MB              | 45.1KB              | 25.1KB                       | 7.9k         | 43                | 1,252,014        | Good          | MIT     |
| [Node-cron](https://blog.logrocket.com/task-scheduling-or-cron-jobs-in-node-using-node-cron/) | 180KB               | 66.8KB              | 5.7KB                        | 2.7k         | 21                | 455,438          | Good          | ISC     |
| [Node-schedule](https://github.com/node-schedule/node-schedule#readme) | 4.00MB              | 88.1KB              | 44.9KB                       | 8.8k         | 95                | 21,642           | Good          | MIT     |
| [Bree](https://jobscheduler.net/#/)                          | 4.88MB              | 88.1KB              | 44.9KB                       | 2.7k         | 95                | 21,642           | Good          | MIT     |
| [Bull](https://github.com/OptimalBits/bull#readme)           | 12.8MB              | 229KB               | 615KB                        | 14.2k        | 171               | 533,883          | Good          | MIT     |
| [Bottleneck](https://github.com/SGrondin/bottleneck#bottleneck) | 615KB               | 122.4KB             | 13.8KB                       | 1.5k         | 79                | 2,014,469        | Good          | MIT     |

* [Agenda](https://github.com/agenda/agenda)
  * æä¾›åŸºäºpromiseçš„ APIã€å…·æœ‰å¯é…ç½®ä¼˜å…ˆçº§å’Œå¹¶å‘æ€§çš„ä½œä¸šè°ƒåº¦ã€ä½œä¸šç»“æœçš„æŒä¹…æ€§ç­‰ç­‰åŠŸèƒ½
  * éœ€è¦æœ‰ä¸€ä¸ªå¯ç”¨çš„ MongoDB æ•°æ®åº“æ‰èƒ½ä½¿ç”¨ Agenda ä½œä¸ºä½œä¸šè°ƒåº¦ç¨‹åº
  * ä¾èµ–è¾ƒå¤š
* [Cron](https://github.com/kelektiv/node-cron)
  * åŠŸèƒ½æ–¹é¢ä¸ Node-cron éå¸¸ç›¸ä¼¼
  * äº 12 å¹´å‰é¦–æ¬¡å‘å¸ƒ
  * æ³¨æ„ï¼ŒCron å’Œ Node-cronåœ¨ GitHubä¸Šå…·æœ‰ç›¸åŒçš„å­˜å‚¨åº“ï¼Œä½†è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„åŒ…
* [Node-cron](https://blog.logrocket.com/task-scheduling-or-cron-jobs-in-node-using-node-cron/)
  * æ”¯æŒåœ¨ç‰¹å®šæ—¶é—´æˆ–æŒ‰æ—¶é—´é—´éš”è§¦å‘ä½œä¸š
  * åªèƒ½åœ¨nodejsç¯å¢ƒä¸­ä½¿ç”¨
  * äºä¸ƒå¹´å‰é¦–æ¬¡å‘å¸ƒ
* [Node-schedule](https://github.com/node-schedule/node-schedule#readme)
  * ä¸»è¦ç”¨äºåŸºäºæ—¶é—´çš„è°ƒåº¦ï¼Œè€Œä¸æ˜¯åŸºäºé—´éš”çš„è°ƒåº¦
  * åªæœ‰åœ¨è„šæœ¬è¿è¡Œæ—¶æ‰ä¼šè§¦å‘ä½œä¸šã€‚å¦‚æœéœ€è¦å®‰æ’ä¸€ä¸ªå³ä½¿åœ¨è„šæœ¬æœªè¿è¡Œæ—¶ä¹Ÿå°†æŒç»­å­˜åœ¨çš„ä½œä¸šï¼Œè¯·è€ƒè™‘ä½¿ç”¨ cron
* [Bree](https://jobscheduler.net/#/)
  * æ—¢å¯ä»¥åœ¨ Node ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
  * æ”¯æŒå¹¶å‘ã€èŠ‚æµã€é•¿æ—¶é—´è¿è¡Œçš„ä½œä¸šç­‰ç­‰
* [Bull](https://github.com/OptimalBits/bull#readme)
  * éœ€è¦è¿è¡Œ Redis æœåŠ¡å™¨
  * åŸºäº cron è¯­æ³•çš„ä½œä¸šè°ƒåº¦ï¼Œæ”¯æŒä½œä¸šé€Ÿç‡é™åˆ¶ã€å¹¶å‘æ€§ã€æ¯ä¸ªé˜Ÿåˆ—è¿è¡Œå¤šä¸ªä½œä¸šã€é‡è¯•å’Œä½œä¸šä¼˜å…ˆçº§ç­‰
* [Bottleneck](https://github.com/SGrondin/bottleneck#bottleneck)
  * è½»é‡çº§ã€é›¶ä¾èµ–çš„ä»»åŠ¡è°ƒåº¦å™¨å’Œé€Ÿç‡é™åˆ¶å™¨
  * æ—¢å¯ä»¥åœ¨ Node.js ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
  * ä¸ä¸Šé¢çš„è°ƒåº¦å™¨ä¸åŒï¼Œå®ƒä¸ä¼šå®‰æ’ä»»åŠ¡åœ¨ç‰¹å®šæ—¶é—´æˆ–ç‰¹å®šæ—¶é—´é—´éš”è¿è¡Œã€‚ç›¸åï¼Œå®ƒä¼šæ„å»ºä¸€ä¸ªä½œä¸šé˜Ÿåˆ—ï¼Œå¹¶æŒ‰ç…§æ¥æ”¶é¡ºåºå°½å¿«æ‰§è¡Œå®ƒä»¬
  * æ‚¨å¯ä»¥é…ç½®å¹¶å‘ä½œä¸šçš„æ•°é‡ä»¥åŠä½œä¸šå¯åŠ¨ä¹‹é—´çš„ç­‰å¾…æ—¶é—´
  * å¯ä»¥é™åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ API è¯·æ±‚é€Ÿç‡æˆ–å¹¶å‘æ€§

> å¦‚æœæ‚¨æ‰“ç®—åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œç®€å•çš„ä½œä¸šè°ƒåº¦ï¼Œæ‚¨å¯ä»¥é€‰æ‹© Cronã€Node-cron å’Œ Node-scheduleï¼Œå› ä¸ºå®ƒä»¬ç®€å•ã€æˆç†Ÿã€æµè¡Œã€ç¨³å®šå¹¶ä¸”å…·æœ‰å‹å¥½çš„è®¸å¯è¯ã€‚æˆ‘å»ºè®®ä½¿ç”¨è¿™ä¸‰ç§æ–¹æ³•ä¹‹ä¸€æ¥å®Œæˆç®€å•çš„å·¥ä½œã€‚

> Agenda å’Œ Bull æä¾›ç®€å•çš„ä½œä¸šè°ƒåº¦ï¼Œä½†éœ€è¦ç‰¹å®šæ•°æ®åº“çš„ååŒæ”¯æŒã€‚é™¤éæ‚¨æœ‰å…´è¶£ä½¿ç”¨å®ƒä»¬æä¾›çš„é™„åŠ åŠŸèƒ½ï¼Œå¦åˆ™ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ã€‚

> å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾å…·æœ‰ä¾‹å¦‚æ”¯æŒå·¥ä½œçº¿ç¨‹æˆ–èƒ½å¤Ÿåœ¨æµè§ˆå™¨å’Œ Node ä¸­è¿è¡Œç­‰æ‰©å±•åŠŸèƒ½çš„è°ƒåº¦ç¨‹åºï¼Œé‚£ä¹ˆ Bree å’Œ Bottleneck å¯èƒ½æ˜¯æ‚¨çš„æœ€ä½³é€‰æ‹©ã€‚

> è°ƒåº¦å™¨çš„åŒ…å¤§å°ä¿¡æ¯æŸ¥è‡ªï¼šhttps://packagephobia.com/
>
> å‚è€ƒæ–‡æ¡£ï¼šhttps://blog.logrocket.com/comparing-best-node-js-schedulers/

# è¿›ç¨‹

## processã€Child Processã€Clusterï¼ˆå†…ç½®æ¨¡å—ï¼‰

**process**ï¼šhttp://nodejs.org/api/process.html

ä»»ä½•ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰å¯åŠ¨è¿›ç¨‹æ—¶ä½¿ç”¨çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œæœ‰æ ‡å‡†è¾“å…¥æ ‡å‡†è¾“å‡ºï¼Œæœ‰è¿è¡Œæƒé™ï¼Œæœ‰è¿è¡Œç¯å¢ƒå’Œè¿è¡ŒçŠ¶æ€ã€‚

åœ¨NodeJSä¸­ï¼Œå¯ä»¥é€šè¿‡`process`å¯¹è±¡æ„ŸçŸ¥å’Œæ§åˆ¶NodeJSè‡ªèº«è¿›ç¨‹çš„æ–¹æ–¹é¢é¢ã€‚

å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`process`ä¸æ˜¯å†…ç½®æ¨¡å—ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå› æ­¤åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

**Child Process**ï¼šhttp://nodejs.org/api/child_process.html

ä½¿ç”¨`child_process`æ¨¡å—å¯ä»¥åˆ›å»ºå’Œæ§åˆ¶å­è¿›ç¨‹ã€‚

è¯¥æ¨¡å—æä¾›çš„APIä¸­æœ€æ ¸å¿ƒçš„æ˜¯`.spawn`ï¼Œå…¶ä½™APIéƒ½æ˜¯é’ˆå¯¹ç‰¹å®šä½¿ç”¨åœºæ™¯å¯¹å®ƒçš„è¿›ä¸€æ­¥å°è£…ï¼Œç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚

**Cluster**ï¼šhttp://nodejs.org/api/cluster.html

`cluster`æ¨¡å—æ˜¯å¯¹`child_process`æ¨¡å—çš„è¿›ä¸€æ­¥å°è£…ï¼Œä¸“ç”¨äºè§£å†³å•è¿›ç¨‹NodeJS WebæœåŠ¡å™¨æ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„é—®é¢˜ã€‚ä½¿ç”¨è¯¥æ¨¡å—å¯ä»¥ç®€åŒ–å¤šè¿›ç¨‹æœåŠ¡å™¨ç¨‹åºçš„å¼€å‘ï¼Œè®©æ¯ä¸ªæ ¸ä¸Šè¿è¡Œä¸€ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œå¹¶ç»Ÿä¸€é€šè¿‡ä¸»è¿›ç¨‹ç›‘å¬ç«¯å£å’Œåˆ†å‘è¯·æ±‚ã€‚



### ä½¿ç”¨

##### 1ã€è·å–å‘½ä»¤è¡Œå‚æ•°ï¼šprocess.arg

`nodeæ‰§è¡Œç¨‹åºè·¯å¾„`å’Œ`ä¸»æ¨¡å—æ–‡ä»¶è·¯å¾„`å›ºå®šå æ®äº†`argv[0]`å’Œ`argv[1]`ä¸¤ä¸ªä½ç½®ï¼Œç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ä»`argv[2]`å¼€å§‹ã€‚

##### 2ã€é€€å‡ºç¨‹åº

é€šå¸¸ä¸€ä¸ªç¨‹åºåšå®Œæ‰€æœ‰äº‹æƒ…åå°±æ­£å¸¸é€€å‡ºäº†ï¼Œè¿™æ—¶ç¨‹åºçš„é€€å‡ºçŠ¶æ€ç ä¸º`0`ã€‚æˆ–è€…ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿäº†å¼‚å¸¸åå°±æŒ‚äº†ï¼Œè¿™æ—¶ç¨‹åºçš„é€€å‡ºçŠ¶æ€ç ä¸ç­‰äº`0`ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­æ•è·äº†æŸä¸ªå¼‚å¸¸ï¼Œè§‰å¾—ç¨‹åºä¸åº”è¯¥ç»§ç»­è¿è¡Œä¸‹å»ï¼Œéœ€è¦ç«‹å³é€€å‡ºï¼Œå¹¶ä¸”éœ€è¦æŠŠé€€å‡ºçŠ¶æ€ç è®¾ç½®ä¸ºæŒ‡å®šæ•°å­—ï¼Œæ¯”å¦‚`1`ï¼Œå°±å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ï¼š`process.exit(1);`

##### 3ã€æ§åˆ¶è¾“å…¥è¾“å‡º

NodeJS ç¨‹åºçš„æ ‡å‡†è¾“å…¥æµï¼ˆstdinï¼‰ã€æ ‡å‡†è¾“å‡ºæµï¼ˆstdoutï¼‰ã€æ ‡å‡†é”™è¯¯æµï¼ˆstderrï¼‰åˆ†åˆ«å¯¹åº”`process.stdin`ã€`process.stdout`å’Œ`process.stderr`ï¼Œç¬¬ä¸€ä¸ªæ˜¯åªè¯»æ•°æ®æµï¼Œåè¾¹ä¸¤ä¸ªæ˜¯åªå†™æ•°æ®æµï¼Œå¯¹å®ƒä»¬çš„æ“ä½œæŒ‰ç…§å¯¹æ•°æ®æµçš„æ“ä½œæ–¹å¼å³å¯ã€‚

ä¾‹å¦‚ï¼š

```js
process.stdout.write('Cleaning RAN! for preparing new project...');
process.stderr.write('please restart it and update env variables or unset NDD_IPC and NODE_OPTIONS.\n');

process.stdin.on("keypress", (ch, key) => {
  if (key && key.name === "escape") {
    process.exit(0);
  }
});
```

##### 4ã€é™æƒ

åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“éœ€è¦ä½¿ç”¨rootæƒé™æ‰èƒ½ç›‘å¬1024ä»¥ä¸‹ç«¯å£ã€‚ä½†æ˜¯ä¸€æ—¦å®Œæˆç«¯å£ç›‘å¬åï¼Œç»§ç»­è®©ç¨‹åºè¿è¡Œåœ¨rootæƒé™ä¸‹å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå› æ­¤æœ€å¥½èƒ½æŠŠæƒé™é™ä¸‹æ¥ã€‚

```js
http.createServer(callback).listen(80, function () {
    var env = process.env,
        uid = parseInt(env['SUDO_UID'] || process.getuid(), 10),
        gid = parseInt(env['SUDO_GID'] || process.getgid(), 10);

    process.setgid(gid);
    process.setuid(uid);
});
```

> ä¸Šä¾‹ä¸­æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
>
> 1. å¦‚æœæ˜¯é€šè¿‡`sudo`è·å–rootæƒé™çš„ï¼Œè¿è¡Œç¨‹åºçš„ç”¨æˆ·çš„UIDå’ŒGIDä¿å­˜åœ¨ç¯å¢ƒå˜é‡`SUDO_UID`å’Œ`SUDO_GID`é‡Œè¾¹ã€‚å¦‚æœæ˜¯é€šè¿‡`chmod +s`æ–¹å¼è·å–rootæƒé™çš„ï¼Œè¿è¡Œç¨‹åºçš„ç”¨æˆ·çš„UIDå’ŒGIDå¯ç›´æ¥é€šè¿‡`process.getuid`å’Œ`process.getgid`æ–¹æ³•è·å–ã€‚
> 2. `process.setuid`å’Œ`process.setgid`æ–¹æ³•åªæ¥å—`number`ç±»å‹çš„å‚æ•°ã€‚
> 3. é™æƒæ—¶å¿…é¡»å…ˆé™GIDå†é™UIDï¼Œå¦åˆ™é¡ºåºåè¿‡æ¥çš„è¯å°±æ²¡æƒé™æ›´æ”¹ç¨‹åºçš„GIDäº†ã€‚

##### 5ã€åˆ›å»ºå­è¿›ç¨‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ›å»ºNodeJSå­è¿›ç¨‹çš„ä¾‹å­ï¼š

```js
var child_process = require('child_process');

var child = child_process.spawn('node', [ 'xxx.js' ]);

child.stdout.on('data', function (data) {
    console.log('stdout: ' + data);
});

child.stderr.on('data', function (data) {
    console.log('stderr: ' + data);
});

child.on('close', function (code) {
    console.log('child process exited with code ' + code);
});
```

> ä¸Šä¾‹ä¸­ä½¿ç”¨äº†`.spawn(exec, args, options)`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ”¯æŒä¸‰ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ˜¯æ‰§è¡Œæ–‡ä»¶çš„ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ ¹æ®PATHç¯å¢ƒå˜é‡èƒ½æ‰¾åˆ°çš„æ‰§è¡Œæ–‡ä»¶åã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½æŒ‰é¡ºåºå¯¹åº”ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°å¯é€‰ï¼Œç”¨äºé…ç½®å­è¿›ç¨‹çš„æ‰§è¡Œç¯å¢ƒä¸è¡Œä¸ºã€‚
>
> ã€€ã€€å¦å¤–ï¼Œä¸Šä¾‹ä¸­è™½ç„¶é€šè¿‡å­è¿›ç¨‹å¯¹è±¡çš„`.stdout`å’Œ`.stderr`è®¿é—®å­è¿›ç¨‹çš„è¾“å‡ºï¼Œä½†é€šè¿‡`options.stdio`å­—æ®µçš„ä¸åŒé…ç½®ï¼Œå¯ä»¥å°†å­è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°ä»»ä½•æ•°æ®æµä¸Šï¼Œæˆ–è€…è®©å­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼Œæˆ–è€…ç›´æ¥å¿½ç•¥å­è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºã€‚

##### 6ã€è¿›ç¨‹é—´é€šè®¯

```js
/* parent.js */
var child = child_process.spawn('node', [ 'child.js' ]);

child.kill('SIGTERM');

/* child.js */
process.on('SIGTERM', function () {
    cleanUp();
    process.exit(0);
});
```

> åœ¨ä¸Šä¾‹ä¸­ï¼Œçˆ¶è¿›ç¨‹é€šè¿‡`.kill`æ–¹æ³•å‘å­è¿›ç¨‹å‘é€`SIGTERM`ä¿¡å·ï¼Œå­è¿›ç¨‹ç›‘å¬`process`å¯¹è±¡çš„`SIGTERM`äº‹ä»¶å“åº”ä¿¡å·**ã€‚**ä¸è¦è¢«`.kill`æ–¹æ³•çš„åç§°è¿·æƒ‘äº†ï¼Œè¯¥æ–¹æ³•æœ¬è´¨ä¸Šæ˜¯ç”¨æ¥ç»™è¿›ç¨‹å‘é€ä¿¡å·çš„ï¼Œè¿›ç¨‹æ”¶åˆ°ä¿¡å·åå…·ä½“è¦åšå•¥ï¼Œå®Œå…¨å–å†³äºä¿¡å·çš„ç§ç±»å’Œè¿›ç¨‹è‡ªèº«çš„ä»£ç ã€‚

å¦å¤–ï¼Œå¦‚æœçˆ¶å­è¿›ç¨‹éƒ½æ˜¯NodeJSè¿›ç¨‹ï¼Œå°±å¯ä»¥é€šè¿‡**IPCï¼ˆè¿›ç¨‹é—´é€šè®¯ï¼‰åŒå‘ä¼ é€’æ•°æ®**ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```js
/* parent.js */
var child = child_process.spawn('node', [ 'child.js' ], {
        stdio: [ 0, 1, 2, 'ipc' ]
    });

child.on('message', function (msg) {
    console.log(msg);
});

child.send({ hello: 'hello' });

/* child.js */
process.on('message', function (msg) {
    msg.hello = msg.hello.toUpperCase();
    process.send(msg);
});
```

> å¯ä»¥çœ‹åˆ°ï¼Œçˆ¶è¿›ç¨‹åœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œåœ¨`options.stdio`å­—æ®µä¸­é€šè¿‡`ipc`å¼€å¯äº†ä¸€æ¡IPCé€šé“ï¼Œä¹‹åå°±å¯ä»¥ç›‘å¬å­è¿›ç¨‹å¯¹è±¡çš„`message`äº‹ä»¶æ¥æ”¶æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡`.send`æ–¹æ³•ç»™å­è¿›ç¨‹å‘é€æ¶ˆæ¯ã€‚åœ¨å­è¿›ç¨‹è¿™è¾¹ï¼Œå¯ä»¥åœ¨`process`å¯¹è±¡ä¸Šç›‘å¬`message`äº‹ä»¶æ¥æ”¶æ¥è‡ªçˆ¶è¿›ç¨‹çš„æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡`.send`æ–¹æ³•å‘çˆ¶è¿›ç¨‹å‘é€æ¶ˆæ¯ã€‚æ•°æ®åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆåœ¨å‘é€ç«¯ä½¿ç”¨`JSON.stringify`æ–¹æ³•åºåˆ—åŒ–ï¼Œå†åœ¨æ¥æ”¶ç«¯ä½¿ç”¨`JSON.parse`æ–¹æ³•ååºåˆ—åŒ–ã€‚

##### 7ã€å®ˆæŠ¤å­è¿›ç¨‹

å®ˆæŠ¤è¿›ç¨‹ä¸€èˆ¬ç”¨äºç›‘æ§å·¥ä½œè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œåœ¨å·¥ä½œè¿›ç¨‹ä¸æ­£å¸¸é€€å‡ºæ—¶é‡å¯å·¥ä½œè¿›ç¨‹ï¼Œä¿éšœå·¥ä½œè¿›ç¨‹ä¸é—´æ–­è¿è¡Œã€‚ä»¥ä¸‹æ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼š

```javascript
/* daemon.js */
function spawn(mainModule) {
    var worker = child_process.spawn('node', [ mainModule ]);

    worker.on('exit', function (code) {
        if (code !== 0) {
            spawn(mainModule);
        }
    });
}

spawn('worker.js');
```



# http

## httpï¼ˆå†…ç½®æ¨¡å—ï¼‰

https://nodejs.org/docs/latest/api/http.html

### ä½¿ç”¨

##### 1. åˆ›å»ºä¸€ä¸ªhttpæœåŠ¡å™¨ï¼šhttp.createServer()

```js
const http = require('http')

const hostname = '127.0.0.1'
const port = 3000

const server = http.createServer((req, res) => {
  res.statusCode = 200
  res.setHeader('Content-Type', 'text/plain') //writeHeadï¼Œ200è¡¨ç¤ºé¡µé¢æ­£å¸¸ï¼Œtext/plainè¡¨ç¤ºæ˜¯æ–‡å­—ã€‚
  res.end('Hello World\n') // end å®Œæˆå†™å…¥
})

server.listen(port, hostname, () => {
  console.log(`æœåŠ¡å™¨è¿è¡Œåœ¨ http://${hostname}:${port}`)
})
```

##### 2.å‘èµ·httpè¯·æ±‚ï¼šhttp.request()

```js
const http = require('http')
const options = {
  host: 'localhost',
  port: 8080,
  method: 'POST',
  path: '/post',
  headers: {
    'Content-Type': 'application/json'
  }
}

// éœ€è¦æ³¨æ„ï¼Œæ­¤æ—¶è¯·æ±‚å¹¶æ²¡å‘å‡º
let req = http.request(options)

// å½“æœåŠ¡å™¨æŠŠè¯·æ±‚ä½“å‘å›æ¥çš„æ—¶å€™ï¼Œæˆ–è€…è¯´å®¢æˆ·ç«¯æ¥å—åˆ°å“åº”çš„æ—¶å€™
req.on('response', (res) => {
  let result = []
  res.on('data', (data) => {
    result.push(data)
  })
  res.on('end', (data) => {
    let str = Buffer.concat(result)
    console.log(str.toString())
  })
})

// å‘è¯·æ±‚ä½“å†™æ•°æ®
req.write('{"name": "zhangsan"}')

// æ˜¯ç»“æŸå†™å…¥è¯·æ±‚ä½“ï¼Œåªæœ‰è°ƒç”¨ end() æ‰ä¼šçœŸæ­£å‘æœåŠ¡å™¨å‘è¯·æ±‚
req.end()
```

## Axios

http://www.axios-js.com/zh-cn/docs/

* Axiosæ—¢å¯ç”¨äºæµè§ˆå™¨ç«¯ä¹Ÿå¯ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œåº•å±‚çš„å®ç°ï¼Œæµè§ˆå™¨ä¸­æ˜¯åŸºäº [XMLHttpRequests](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)ï¼Œè€Œnode.js ä¸­åˆ™æ˜¯åŸºäº [http](http://nodejs.org/api/http.html) è¯·æ±‚ã€‚
* åŸºäº`Promise`
* è‡ªåŠ¨å°†å“åº”æ•°æ®è½¬æ¢ä¸ºJSONå¯¹è±¡
* å®‰è£…ï¼š`npm install axios --save`

### ä½¿ç”¨

```js
const axios = require('axios');

axios.get('https://jsonplaceholder.typicode.com/todos/1')
  .then(res => {
    console.log(res.data.id);
    console.log(res.data.title);
  })
  .catch(err => {
    console.log(err);
  });
```

## Socket.IO

https://socket.io/

ç”¨æå…¶ç®€å•çš„è¯­æ³•ï¼Œåœ¨æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´ï¼Œå»ºç«‹å¯é çš„socketé•¿è¿æ¥é€šä¿¡ã€‚

* ###### é«˜æ€§èƒ½

  åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨WebSocketå»ºç«‹è¿æ¥ï¼Œåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´æä¾›ä½è´Ÿè½½é€šä¿¡é€šé“ã€‚

* ###### å¯é çš„

  è¿æ¥å®‰å…¨ï¼å¦‚æœWebSocketè¿æ¥ä¸å¯èƒ½ï¼Œå®ƒå°†è¿”å›åˆ°HTTPé•¿è½®è¯¢ã€‚å¦‚æœè¿æ¥ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯å°†è‡ªåŠ¨å°è¯•é‡æ–°è¿æ¥ã€‚

* ###### å¯æ‰©å±•

  å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œå¹¶è½»æ¾åœ°å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å‘é€äº‹ä»¶ã€‚

### ä½¿ç”¨

##### æœåŠ¡ç«¯

```js
import { Server } from 'socket.io';
const io = new Server(3000);

io.on("connection", (socket) => {
	// send a message to the client
  socket.emit("hello", "world")
  
  // receive a message from the client
  socket.on("howdy", (arg) => {
    console.log(arg); // prints "stranger"
  })
})
```

##### å®¢æˆ·ç«¯

```js
import { io } from 'socket.io-client'
const socket = io("ws://localhost:3000")

// receive a message from the server
socket.on("hello", (arg) => {
  console.log(arg); // prints "world"
})

// send a message to the server
socket.emit("howdy", "stranger");
```



### æ‰©å±•ä¸€ä¸‹ï¼Œå…³äºwså’Œwss

https://runnerliu.github.io/2021/02/18/wsandwss/





ä»¥ä¸Šï¼Œä½œä¸ºNodeJså¼€å‘å·¥å…·é€‰æ‹©çš„ä¸€ä¸ªå‚è€ƒï¼Œupdate by 2023.12.19.
